## Summary

Add SAP AI Core as a first-class provider in Bifrost with OAuth2 authentication, deployment resolution, and multi-backend routing (OpenAI, Anthropic/Amazon via Bedrock, Google Vertex/Gemini). This PR implements native tool/function calling for Anthropic (via Bedrock Converse) and Gemini, fixes vision input handling, and adds Responses API support (non-streaming and streaming) for Bedrock-backed models. It also resolves compaction failures when historical tool calls are replayed without an explicit `toolConfig`.

## Changes

- SAP AI Core provider
  - OAuth2 client-credentials flow with token caching and early refresh
  - Deployment auto-resolution (static map + dynamic discovery) with TTL caching
  - Backend routing based on model prefix: OpenAI, Bedrock (Anthropic/Amazon), Vertex (Gemini)
- Tool/function calling
  - Anthropic/Amazon: switched Chat + Responses to Bedrock Converse (`/converse`, `/converse-stream`) for native tool calls
  - Gemini: added native function calling, schema `$ref` cleanup (`resolveSchemaRefs`)
  - Role mapping for Anthropic: `developer` -> `user`
- Responses API
  - Implemented for Bedrock-backed models (Anthropic/Amazon) including streaming
  - Added Bedrock Converse converters, parsers, and stream processors
- Bug fixes
  - Vision: corrected image block pointer access in Responses conversions
  - Compaction: `ensureToolConfigForHistory()` builds stub `toolConfig` from history (`toolUse`/`toolResult`) to satisfy Bedrock
- Documentation
  - Updated SAP AI Core provider guide: mark Responses supported (non-stream/stream) for Bedrock, add Responses API examples, clarify native tool calling via Converse
- Cleanup
  - Removed dead/debug code, unused imports; updated tests for converters and error handling

Notable design decisions/trade-offs:
- Confined implementation changes to SAP AI Core provider where possible to keep upstream impact minimal
- Responses API support limited to Bedrock where Converse exists; OpenAI/Vertex continue via Chat Completions
- Image Generation API remains unsupported; vision is supported through chat/responses multimodal content

## Type of change

- [x] Bug fix
- [x] Feature
- [ ] Refactor
- [x] Documentation
- [ ] Chore/CI

## Affected areas

- [x] Core (Go)
- [x] Transports (HTTP)
- [x] Providers/Integrations
- [ ] Plugins
- [x] UI (Next.js)
- [x] Docs

## How to test

1) Build and run
```sh
make build LOCAL=1
./tmp/bifrost-http -log-level debug -log-style pretty -port 8080
```

2) Go tests
```sh
go version
go test ./...

# Provider-specific
cd core
go test ./providers/sapaicore/... -v
```

3) Configure SAP AI Core credentials (env or config store)
- Required: `client_id`, `client_secret`, `auth_url`, `base_url`, `resource_group`
- Optional: static `deployments` map for faster routing

4) Chat Completions (Anthropic via Bedrock)
```sh
curl -X POST http://localhost:8080/v1/chat/completions \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_BIFROST_KEY" \
  -d '{
    "model": "sapaicore/anthropic--claude-3.5-sonnet",
    "messages": [{"role":"user","content":"Hello!"}],
    "max_completion_tokens": 1024
  }'
```

5) Responses API (non-streaming, Anthropic via Bedrock)
```sh
curl -X POST http://localhost:8080/v1/responses \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_BIFROST_KEY" \
  -d '{
    "model": "sapaicore/anthropic--claude-3.5-sonnet",
    "input": [{"role":"user","content":[{"type":"input_text","text":"What'\''s the weather in Paris?"}]}]
  }'
```

6) Responses API (streaming + tool calling)
```sh
curl -N -X POST http://localhost:8080/v1/responses \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_BIFROST_KEY" \
  -d '{
    "model": "sapaicore/anthropic--claude-3.5-sonnet",
    "input": [{"role":"user","content":[{"type":"input_text","text":"What'\''s the weather in Paris and Berlin?"}]}],
    "tools": [{
      "type": "function",
      "function": {
        "name": "get_weather",
        "description": "Get current weather by city name",
        "parameters": {
          "type": "object",
          "properties": { "city": { "type": "string" } },
          "required": ["city"]
        }
      }
    }],
    "stream": true
  }'
```

7) Vision input in Responses
- Add `{"type":"input_image","image_url":"https://.../image.jpg"}` to user content; expect normal processing with no blank-text chunks

8) Compaction with historical tool calls
- Replay prior `tool_use`/`tool_result` blocks in a compaction request (e.g., Opus); verify no "toolConfig must be defined" error and successful completion

If adding new configs or environment variables, document them here:
- `SAP_AI_CORE_CLIENT_ID`, `SAP_AI_CORE_CLIENT_SECRET`, `SAP_AI_CORE_AUTH_URL`, `SAP_AI_CORE_BASE_URL`, `SAP_AI_CORE_RESOURCE_GROUP`

## Screenshots/Recordings

N/A (UI changes are provider config fields only)

## Breaking changes

- [ ] Yes
- [x] No

## Related issues

Closes #233

## Security considerations

- OAuth2 tokens cached with early refresh; thread-safe access
- Credentials handled via EnvVar fields; redacted/encrypted in persistence
- Extra headers limited to configured allow-list; no expansion of PII surface
- Tool calling schemas validated and normalized before provider calls

## Checklist

- [x] I read `docs/contributing/README.md` and followed the guidelines
- [x] I added/updated tests where appropriate
- [x] I updated documentation where needed
- [x] I verified builds succeed (Go and UI)
- [x] I verified the CI pipeline passes locally if applicable
